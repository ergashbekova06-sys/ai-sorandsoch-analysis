import streamlit as st
import pandas as pd

st.set_page_config(page_title="–ê–Ω–∞–ª–∏–∑ –°–û–† –∏ –°–û–ß", layout="wide")

st.title("üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –°–û–† –∏ –°–û–ß")

uploaded_file = st.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª Excel", type=["xlsx", "xls"])

if uploaded_file:
    df = pd.read_excel(uploaded_file, header=None)

    # -----------------------------------------------------------
    # 1. –ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É, –≥–¥–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ (—Ç–∞–º –≥–¥–µ '–ü—Ä–µ–¥–º–µ—Ç')
    # -----------------------------------------------------------
    start_row = None
    for i in range(len(df)):
        if isinstance(df.loc[i, 0], str) and "–ü—Ä–µ–¥–º–µ—Ç" in df.loc[i, 0]:
            start_row = i
            break

    if start_row is None:
        st.error("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ç–∞–±–ª–∏—Ü—É –≤ —Ñ–∞–π–ª–µ.")
        st.stop()

    # –ß–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É: —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ = –Ω–∞—á–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö
    table = df.iloc[start_row + 1 : start_row + 4, 0:8]
    table.columns = [
        "–ü—Ä–µ–¥–º–µ—Ç",
        "–£—á–µ–Ω–∏–∫",
        "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª",
        "–Ω–∏–∑–∫–∏–π",
        "—Å—Ä–µ–¥–Ω–∏–π",
        "–≤—ã—Å–æ–∫–∏–π",
        "% –∫–∞—á–µ—Å—Ç–≤–∞",
        "% —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏",
    ]

    st.subheader("üìå –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –°–û–† –∏ –°–û–ß")
    st.dataframe(table)

    # -----------------------------------------------------------
    # 2. –î–∏–∞–≥—Ä–∞–º–º–∞
    # -----------------------------------------------------------
    st.subheader("üìà –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏")
    chart_df = table.set_index("–ü—Ä–µ–¥–º–µ—Ç")[["% –∫–∞—á–µ—Å—Ç–≤–∞", "% —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏"]]
    st.bar_chart(chart_df)

    # -----------------------------------------------------------
    # 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã–≤–æ–¥–æ–≤
    # -----------------------------------------------------------
    st.subheader("üìù –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏")

    best_quality = table.loc[table["% –∫–∞—á–µ—Å—Ç–≤–∞"].idxmax(), "–ü—Ä–µ–¥–º–µ—Ç"]
    worst_quality = table.loc[table["% –∫–∞—á–µ—Å—Ç–≤–∞"].idxmin(), "–ü—Ä–µ–¥–º–µ—Ç"]

    best_success = table.loc[table["% —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏"].idxmax(), "–ü—Ä–µ–¥–º–µ—Ç"]
    worst_success = table.loc[table["% —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏"].idxmin(), "–ü—Ä–µ–¥–º–µ—Ç"]

    avg_quality = table["% –∫–∞—á–µ—Å—Ç–≤–∞"].mean()
    avg_success = table["% —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏"].mean()

    st.markdown(f"""
    ### –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã:
    - –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∫–∞—á–µ—Å—Ç–≤–∞: **{avg_quality:.1f}%**
    - –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏: **{avg_success:.1f}%**

    ### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:
    - –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ —É: **{best_quality}**
    - –õ—É—á—à–∞—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å —É: **{best_success}**

    ### –ó–æ–Ω—ã –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è:
    - –°–∞–º–æ–µ –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —É: **{worst_quality}**
    - –°–∞–º–∞—è –Ω–∏–∑–∫–∞—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å —É: **{worst_success}**

    ### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
    - –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É **{worst_quality}**.
    - –£—Å–∏–ª–∏—Ç—å –ø—Ä–æ—Ä–∞–±–æ—Ç–∫—É —Ç–µ–º, –≥–¥–µ —É —É—á–∞—â–∏—Ö—Å—è –Ω–∏–∑–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    - –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏—ë–º—ã, —É—Å–ø–µ—à–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –≤ **{best_quality}**.
    - –ü—Ä–æ–≤–µ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∏–Ω–∏-–°–û–† –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ç–µ–º–∞–º.
    """)

    st.success("–ê–Ω–∞–ª–∏–∑ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω!")
